@page "/EditUser/{UserId:int}"  
@* vi skal være obs på Insecure Direct Object Reference (IDOR) angreb... husk adgangskontrol *@
@layout AdminLayout
@rendermode InteractiveServer

@using System.Security.Cryptography
@using System.Text
@using Microsoft.EntityFrameworkCore
@using ServiceContracts
@using TravelFusionLean.Data
@using TravelFusionLean.Components.Layout
@using TravelFusionLean.Models
@using System.ComponentModel.DataAnnotations
@using TravelFusionLean.Components.Layout

@inject AppDbContext DbContext
@inject NavigationManager NavigationManager

@code {
    [Parameter]
    public int UserId { get; set; }

    private User user = new();

    protected override void OnInitialized()
    {
        user = DbContext.Users
            .Include(u => u.UserRole)
            .FirstOrDefault(u => u.Id == UserId);
    }

    private void SaveChanges()
    {
        DbContext.Users.Update(user);
        DbContext.SaveChanges();
        NavigationManager.NavigateTo("/UserList");
    }
}
<h3>Rediger bruger</h3>

<EditForm Model="@user" OnValidSubmit="@SaveChanges">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Brugernavn</label>
        <InputText class="form-control" @bind-Value="user.Username" />
    </div>

    <div class="mb-3">
        <label>Email</label>
        <InputText class="form-control" @bind-Value="user.Email" />
    </div>

    <button type="submit" class="btn btn-primary">Gem ændringer</button>
</EditForm>
