@page "/travel-package-flights"
@inject IFlightApiService FlightApiService
@using TravelFusionLean.Components.Layout.Admin
@using Shared.Models
@layout AdminLayout
@inject NavigationManager NavigationManager
@rendermode InteractiveServer


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="css/CustomColors.css" rel="stylesheet" />

<div class="container mt-4">
    <h2 class="text-center">Choose Flight</h2>

    <!-- Search Bar -->
    <div class="card p-3 mb-3">
        <div class="row">
            <div class="col-md-3">
                <label>Departure:</label>
                <input type="text" class="form-control" placeholder="Enter departure city">
            </div>
            <div class="col-md-3">
                <label>Destination:</label>
                <input type="text" class="form-control" placeholder="Enter destination city">
            </div>
            <div class="col-md-3">
                <label>When:</label>
                <input type="text" class="form-control" placeholder="Select dates">
            </div>
            <div class="col-md-2">
                <label>Travellers:</label>
                <input type="text" class="form-control" placeholder="Enter number of travelers">
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button class="btn btn-primary w-100">üîç</button>
            </div>
        </div>
    </div>

    <!-- Tabs for fastest / cheapest / best -->
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" data-bs-target="#fastest" role="tab">Fastest</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" data-bs-target="#cheapest" role="tab">Cheapest</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" data-bs-target="#best" role="tab">Best</a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="fastest" class="tab-pane fade show active p-3">
            @if (flights == null)
            {
                <p><em>Loading flights...</em></p> <!-- Tror farven skal √¶ndres -->
            }
            else if (!flights.Any())
            {
                <p>No flights found.</p>
            }
            else
            {
                @foreach (var flight in flights)
                {
                    <div class="d-flex justify-content-between border p-2 mb-2">
                        <div>
                            <strong>@flight.Airline</strong>
                            @flight.DepartureTime.ToString("HH:mm") ‚Üí
                            @flight.ArrivalTime.ToString("HH:mm")
                            -
                            @flight.Price.ToString("0.00") @flight.Currency?.Name
                        </div>
                        <button class="btn btn-sm btn-outline-primary" @onclick="() => SelectFlight(flight)">Select</button>
                    </div>
                }
            }
        </div>

        <div id="cheapest" class="tab-pane fade p-3">
            <p>Filtering logic not implemented yet.</p>
        </div>
        <div id="best" class="tab-pane fade p-3">
            <p>Filtering logic not implemented yet.</p>
        </div>
    </div>

    <!-- Selected Flight Summary -->
    @if (selectedFlight != null)
    {
        <div class="card mt-3 p-3">
            <h5>Selected Flight</h5>
            <p>
                <strong>@selectedFlight.Airline</strong><br />
                FROM: @selectedFlight.DepartureFromAirport?.City<br />
                TO: @selectedFlight.ArrivalAtAirport?.City<br />
                Departure: @selectedFlight.DepartureTime.ToString("g")<br />
                Arrival: @selectedFlight.ArrivalTime.ToString("g")<br />
                Class: @selectedFlight.ClassType<br />
                Seats: @selectedFlight.SeatsAvailable<br />
                Total: @selectedFlight.Price.ToString("0.00") @selectedFlight.Currency?.Name
            </p>
            <button class="btn btn-primary">Choose Flight</button>
        </div>
    }
</div>



<div class="container mt-4">
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-primary" @onclick="GoToHotelSelection" disabled="@(!CanProceed)">
            <i class="fa fa-bed"></i> Choose Flight
        </button>

    </div>
</div>


@code {
    private bool CanProceed => selectedFlight != null;

    private List<Flight>? flights;
    private Flight? selectedFlight;

    /// <summary>
    /// Kaldes ved indl√¶sning af siden og henter alle flights via service.
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        try
        {
            flights = (await FlightApiService.GetAllFlightsAsync()).ToList();
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine("Error loading flights: " + ex.Message);
        }
    }

    /// <summary>
    /// Kaldes n√•r en bruger v√¶lger et fly i UI'et.
    /// </summary>
    private void SelectFlight(Flight flight)
    {
        selectedFlight = flight;
    }

    private void GoToHotelSelection()
    {
        NavigationManager.NavigateTo("/travel-package-hotels");
    }
}
